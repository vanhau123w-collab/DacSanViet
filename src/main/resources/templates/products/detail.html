<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
    <title th:text="${product != null ? product.name + ' - Đặc Sản Quê Hương' : 'Chi Tiết Sản Phẩm'}">Chi Tiết Sản Phẩm</title>
</head>
<body>
    <th:block layout:fragment="content">
        <div class="container py-4" th:if="${product != null}">
            <!-- Breadcrumb -->
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a th:href="@{/}">Trang Chủ</a></li>
                    <li class="breadcrumb-item"><a th:href="@{/products}">Sản Phẩm</a></li>
                    <li class="breadcrumb-item" th:if="${product.category != null}">
                        <a th:href="@{/products(category=${product.category.id})}" 
                           th:text="${product.category.name}">Category</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page" th:text="${product.name}">Product</li>
                </ol>
            </nav>

            <div class="row">
                <!-- Product Images -->
                <div class="col-lg-6 mb-4">
                    <div class="product-images">
                        <!-- Main image -->
                        <div class="main-image mb-3">
                            <img th:src="${product.imageUrl != null ? product.imageUrl : '/images/placeholder-product.jpg'}" 
                                 class="img-fluid rounded shadow" th:alt="${product.name}" id="mainProductImage">
                        </div>
                        
                        <!-- Thumbnail images (placeholder for multiple images) -->
                        <div class="thumbnail-images d-flex gap-2">
                            <img th:src="${product.imageUrl != null ? product.imageUrl : '/images/placeholder-product.jpg'}" 
                                 class="img-thumbnail" style="width: 80px; height: 80px; object-fit: cover; cursor: pointer;"
                                 th:alt="${product.name}" onclick="changeMainImage(this.src)">
                            <!-- Additional thumbnails would go here -->
                        </div>
                    </div>
                </div>

                <!-- Product Information -->
                <div class="col-lg-6">
                    <div class="product-info">
                        <!-- Product name -->
                        <h1 class="fw-bold mb-3" th:text="${product.name}">Product Name</h1>

                        <!-- Category -->
                        <div class="mb-3" th:if="${product.category != null}">
                            <span class="badge bg-secondary">
                                <i class="bi bi-tag me-1"></i>
                                <span th:text="${product.category.name}">Category</span>
                            </span>
                        </div>

                        <!-- Price -->
                        <div class="price-section mb-4">
                            <div class="d-flex align-items-center gap-3">
                                <span class="price h3 mb-0" th:text="${#numbers.formatCurrency(product.price)}">$0.00</span>
                                <span th:if="${product.salePrice != null and product.salePrice < product.price}" 
                                      class="price-old h5 mb-0" th:text="${#numbers.formatCurrency(product.price)}">$0.00</span>
                                <span th:if="${product.salePrice != null and product.salePrice < product.price}" 
                                      class="badge bg-danger">
                                    SALE -<span th:text="${#numbers.formatPercent((product.price - product.salePrice) / product.price)}">0%</span>
                                </span>
                            </div>
                        </div>

                        <!-- Stock status -->
                        <div class="stock-status mb-4">
                            <div th:if="${product.stockQuantity > 0}" class="d-flex align-items-center text-success">
                                <i class="bi bi-check-circle me-2"></i>
                                <span>Còn hàng (<span th:text="${product.stockQuantity}">0</span> sản phẩm)</span>
                            </div>
                            <div th:if="${product.stockQuantity == 0}" class="d-flex align-items-center text-danger">
                                <i class="bi bi-x-circle me-2"></i>
                                <span>Hết hàng</span>
                            </div>
                            <div th:if="${product.stockQuantity > 0 and product.stockQuantity <= 5}" 
                                 class="d-flex align-items-center text-warning mt-2">
                                <i class="bi bi-exclamation-triangle me-2"></i>
                                <span>Chỉ còn lại <span th:text="${product.stockQuantity}">0</span> sản phẩm</span>
                            </div>
                        </div>

                        <!-- Add to cart form -->
                        <form th:if="${product.stockQuantity > 0}" class="add-to-cart-form mb-4">
                            <div class="row g-3 align-items-end">
                                <div class="col-md-4">
                                    <label for="quantity" class="form-label">Số lượng</label>
                                    <div class="input-group">
                                        <button class="btn btn-outline-secondary" type="button" onclick="decreaseQuantity()">
                                            <i class="bi bi-dash"></i>
                                        </button>
                                        <input type="number" class="form-control text-center" id="quantity" 
                                               value="1" min="1" th:max="${product.stockQuantity}">
                                        <button class="btn btn-outline-secondary" type="button" onclick="increaseQuantity()">
                                            <i class="bi bi-plus"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <div class="d-grid gap-2">
                                        <button type="button" class="btn btn-primary btn-lg add-to-cart-btn" 
                                                th:data-product-id="${product.id}">
                                            <i class="bi bi-cart-plus me-2"></i>Thêm Vào Giỏ Hàng
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>

                        <!-- Out of stock message -->
                        <div th:if="${product.stockQuantity == 0}" class="alert alert-warning">
                            <i class="bi bi-exclamation-triangle me-2"></i>
                            Sản phẩm này hiện đang hết hàng. Vui lòng quay lại sau hoặc liên hệ với chúng tôi để được thông báo khi có hàng.
                        </div>

                        <!-- Product features -->
                        <div class="product-features">
                            <div class="row g-3">
                                <div class="col-6">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-shield-check text-success me-2"></i>
                                        <small>Chất lượng đảm bảo</small>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-truck text-primary me-2"></i>
                                        <small>Giao hàng nhanh</small>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-arrow-return-left text-info me-2"></i>
                                        <small>Đổi trả dễ dàng</small>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-headset text-warning me-2"></i>
                                        <small>Hỗ trợ 24/7</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Product Details Tabs -->
            <div class="row mt-5">
                <div class="col-12">
                    <ul class="nav nav-tabs" id="productTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="description-tab" data-bs-toggle="tab" 
                                    data-bs-target="#description" type="button" role="tab">
                                <i class="bi bi-file-text me-2"></i>Mô Tả
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="specifications-tab" data-bs-toggle="tab" 
                                    data-bs-target="#specifications" type="button" role="tab">
                                <i class="bi bi-list-ul me-2"></i>Thông Số
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" 
                                    data-bs-target="#reviews" type="button" role="tab">
                                <i class="bi bi-star me-2"></i>Đánh Giá
                            </button>
                        </li>
                    </ul>
                    <div class="tab-content border border-top-0 p-4" id="productTabsContent">
                        <!-- Description -->
                        <div class="tab-pane fade show active" id="description" role="tabpanel">
                            <div th:if="${product.description != null and !#strings.isEmpty(product.description)}">
                                <p th:text="${product.description}">Product description goes here...</p>
                            </div>
                            <div th:if="${product.description == null or #strings.isEmpty(product.description)}">
                                <p class="text-muted">Chưa có mô tả chi tiết cho sản phẩm này.</p>
                            </div>
                        </div>
                        
                        <!-- Specifications -->
                        <div class="tab-pane fade" id="specifications" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <table class="table table-borderless">
                                        <tr>
                                            <td class="fw-bold">Danh mục:</td>
                                            <td th:text="${product.category != null ? product.category.name : 'Chưa phân loại'}">Category</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">Trạng thái:</td>
                                            <td>
                                                <span th:if="${product.stockQuantity > 0}" class="badge bg-success">Còn hàng</span>
                                                <span th:if="${product.stockQuantity == 0}" class="badge bg-danger">Hết hàng</span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">Số lượng:</td>
                                            <td th:text="${product.stockQuantity}">0</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Reviews -->
                        <div class="tab-pane fade" id="reviews" role="tabpanel">
                            <div class="text-center py-4">
                                <i class="bi bi-star display-4 text-muted"></i>
                                <h5 class="mt-3">Chưa có đánh giá</h5>
                                <p class="text-muted">Hãy là người đầu tiên đánh giá sản phẩm này!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Related Products -->
            <div class="row mt-5" th:if="${relatedProducts != null and !relatedProducts.empty}">
                <div class="col-12">
                    <h3 class="fw-bold mb-4">Sản Phẩm Liên Quan</h3>
                    <div class="row g-4">
                        <div class="col-lg-3 col-md-6" th:each="relatedProduct : ${relatedProducts}">
                            <div th:replace="~{fragments/components :: product-card(${relatedProduct})}"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product not found -->
        <div class="container py-5" th:if="${product == null}">
            <div class="text-center">
                <i class="bi bi-exclamation-triangle display-1 text-muted"></i>
                <h2 class="mt-3">Không Tìm Thấy Sản Phẩm</h2>
                <p class="text-muted mb-4">Sản phẩm bạn đang tìm kiếm không tồn tại hoặc đã bị xóa.</p>
                <a th:href="@{/products}" class="btn btn-primary">
                    <i class="bi bi-arrow-left me-2"></i>Quay Lại Danh Sách Sản Phẩm
                </a>
            </div>
        </div>
    </th:block>

    <th:block layout:fragment="scripts-extra">
        <script>
            // Quantity controls
            function increaseQuantity() {
                const input = document.getElementById('quantity');
                const max = parseInt(input.getAttribute('max'));
                const current = parseInt(input.value);
                if (current < max) {
                    input.value = current + 1;
                }
            }

            function decreaseQuantity() {
                const input = document.getElementById('quantity');
                const min = parseInt(input.getAttribute('min'));
                const current = parseInt(input.value);
                if (current > min) {
                    input.value = current - 1;
                }
            }

            // Change main image
            function changeMainImage(src) {
                document.getElementById('mainProductImage').src = src;
            }

            // Add to cart with quantity
            document.querySelector('.add-to-cart-btn').addEventListener('click', function() {
                const quantity = document.getElementById('quantity').value;
                this.setAttribute('data-quantity', quantity);
            });
        </script>
    </th:block>
</body>
</html>