<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
    <title>Thêm Sản Phẩm Mới - Admin</title>
    <style>
        .form-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 2rem;
        }
        
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            border-radius: 10px;
            border: 2px dashed #dee2e6;
            padding: 1rem;
            text-align: center;
            margin-top: 1rem;
        }
        
        .image-preview img {
            max-width: 100%;
            max-height: 150px;
            border-radius: 8px;
        }
        
        .required {
            color: #dc3545;
        }
    </style>
</head>
<body>
    <th:block layout:fragment="content">
        <div class="container mt-4">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h3 mb-0">
                    <i class="bi bi-plus-circle me-2"></i>Thêm Sản Phẩm Mới
                </h1>
                <a th:href="@{/admin/products}" class="btn btn-secondary">
                    <i class="bi bi-arrow-left me-1"></i>Quay lại
                </a>
            </div>
            
            <!-- Form -->
            <div class="form-container">
                <form th:action="@{/admin/products/create}" th:object="${product}" method="post" enctype="multipart/form-data">
                    <div class="row">
                        <!-- Basic Information -->
                        <div class="col-md-8">
                            <h5 class="mb-3">Thông tin cơ bản</h5>
                            
                            <!-- Product Name -->
                            <div class="mb-3">
                                <label for="name" class="form-label">
                                    Tên sản phẩm <span class="required">*</span>
                                </label>
                                <input type="text" class="form-control" id="name" th:field="*{name}" 
                                       th:classappend="${#fields.hasErrors('name')} ? 'is-invalid'" 
                                       placeholder="Nhập tên sản phẩm">
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
                            </div>
                            
                            <!-- Description -->
                            <div class="mb-3">
                                <label for="description" class="form-label">Mô tả sản phẩm</label>
                                <textarea class="form-control" id="description" th:field="*{description}" 
                                          rows="4" placeholder="Nhập mô tả chi tiết về sản phẩm"></textarea>
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('description')}" th:errors="*{description}"></div>
                            </div>
                            
                            <!-- Category -->
                            <div class="mb-3">
                                <label for="categoryId" class="form-label">
                                    Danh mục <span class="required">*</span>
                                </label>
                                <select class="form-select" id="categoryId" th:field="*{categoryId}"
                                        th:classappend="${#fields.hasErrors('categoryId')} ? 'is-invalid'">
                                    <option value="">Chọn danh mục</option>
                                    <option th:each="category : ${categories}" 
                                            th:value="${category.id}" 
                                            th:text="${category.name}">Danh mục</option>
                                </select>
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('categoryId')}" th:errors="*{categoryId}"></div>
                            </div>
                            
                            <!-- Price and Stock -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="price" class="form-label">
                                            Giá (VNĐ) <span class="required">*</span>
                                        </label>
                                        <input type="number" class="form-control" id="price" th:field="*{price}" 
                                               step="1000" min="0"
                                               th:classappend="${#fields.hasErrors('price')} ? 'is-invalid'" 
                                               placeholder="0">
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('price')}" th:errors="*{price}"></div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="stockQuantity" class="form-label">
                                            Số lượng kho <span class="required">*</span>
                                        </label>
                                        <input type="number" class="form-control" id="stockQuantity" th:field="*{stockQuantity}" 
                                               min="0"
                                               th:classappend="${#fields.hasErrors('stockQuantity')} ? 'is-invalid'" 
                                               placeholder="0">
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('stockQuantity')}" th:errors="*{stockQuantity}"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Weight and Origin -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="weightGrams" class="form-label">Trọng lượng (gram)</label>
                                        <input type="number" class="form-control" id="weightGrams" th:field="*{weightGrams}" 
                                               min="0" placeholder="0">
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('weightGrams')}" th:errors="*{weightGrams}"></div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="origin" class="form-label">Xuất xứ</label>
                                        <input type="text" class="form-control" id="origin" th:field="*{origin}" 
                                               placeholder="Ví dụ: Hà Nội, Việt Nam">
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('origin')}" th:errors="*{origin}"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Image and Settings -->
                        <div class="col-md-4">
                            <h5 class="mb-3">Hình ảnh & Cài đặt</h5>
                            
                            <!-- Image Upload -->
                            <div class="mb-3">
                                <label for="imageFile" class="form-label">Hình ảnh sản phẩm</label>
                                <input type="file" class="form-control" id="imageFile" name="imageFile" 
                                       accept="image/*" onchange="previewImage(this)">
                                <div class="image-preview" id="imagePreview">
                                    <i class="bi bi-image fs-1 text-muted"></i>
                                    <p class="text-muted mt-2">Chọn hình ảnh</p>
                                </div>
                            </div>
                            
                            <!-- Image URL (alternative) -->
                            <div class="mb-3">
                                <label for="imageUrl" class="form-label">Hoặc URL hình ảnh</label>
                                <input type="url" class="form-control" id="imageUrl" th:field="*{imageUrl}" 
                                       placeholder="https://example.com/image.jpg">
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('imageUrl')}" th:errors="*{imageUrl}"></div>
                            </div>
                            
                            <!-- Status Settings -->
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="isActive" th:field="*{isActive}" checked>
                                    <label class="form-check-label" for="isActive">
                                        Kích hoạt sản phẩm
                                    </label>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="isFeatured" th:field="*{isFeatured}">
                                    <label class="form-check-label" for="isFeatured">
                                        Sản phẩm nổi bật
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Submit Buttons -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <hr>
                            <div class="d-flex justify-content-end gap-2">
                                <a th:href="@{/admin/products}" class="btn btn-secondary">
                                    <i class="bi bi-x-circle me-1"></i>Hủy
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-check-circle me-1"></i>Tạo sản phẩm
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </th:block>
    
    <th:block layout:fragment="scripts-extra">
        <script>
            function previewImage(input) {
                const preview = document.getElementById('imagePreview');
                
                if (input.files && input.files[0]) {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        preview.innerHTML = '<img src="' + e.target.result + '" alt="Preview">';
                    }
                    
                    reader.readAsDataURL(input.files[0]);
                } else {
                    preview.innerHTML = '<i class="bi bi-image fs-1 text-muted"></i><p class="text-muted mt-2">Chọn hình ảnh</p>';
                }
            }
            
            // Preview image from URL
            document.getElementById('imageUrl').addEventListener('input', function() {
                const url = this.value;
                const preview = document.getElementById('imagePreview');
                
                if (url) {
                    preview.innerHTML = '<img src="' + url + '" alt="Preview" onerror="this.style.display=\'none\'">';
                } else {
                    preview.innerHTML = '<i class="bi bi-image fs-1 text-muted"></i><p class="text-muted mt-2">Chọn hình ảnh</p>';
                }
            });
        </script>
    </th:block>
</body>
</html>